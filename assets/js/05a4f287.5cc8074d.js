"use strict";(self.webpackChunkmobile_pay_merchant_payments_documentation=self.webpackChunkmobile_pay_merchant_payments_documentation||[]).push([[7420],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),u=s(n),d=r,y=u["".concat(l,".").concat(d)]||u[d]||c[d]||i;return n?a.createElement(y,p(p({ref:t},m),{},{components:n})):a.createElement(y,p({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,p=new Array(i);p[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,p[1]=o;for(var s=2;s<i;s++)p[s]=n[s];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7685:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>p,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const i={sidebar_position:2},p="Create And Manage Payments",o={unversionedId:"app-payments/payments-refunds/create-payments",id:"app-payments/payments-refunds/create-payments",title:"Create And Manage Payments",description:"Payments API lets developers create and manage payments. It is important to remember, that payment cannot be completed without user interaction, meaning that the user has to swipe and approve payments inside MobilePay app.",source:"@site/docs/app-payments/payments-refunds/create-payments.md",sourceDirName:"app-payments/payments-refunds",slug:"/app-payments/payments-refunds/create-payments",permalink:"/MobilePay-Payments-API/docs/app-payments/payments-refunds/create-payments",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Overview",permalink:"/MobilePay-Payments-API/docs/app-payments/payments-refunds/overview"},next:{title:"Refund Payments",permalink:"/MobilePay-Payments-API/docs/app-payments/payments-refunds/refund-payments"}},l={},s=[{value:"Create payment",id:"create-payment",level:2},{value:"Get single payment details",id:"get-single-payment-details",level:2},{value:"Get all payments",id:"get-all-payments",level:2},{value:"Capture payment",id:"capture-payment",level:2},{value:"Cancel payment",id:"cancel-payment",level:2},{value:"Cancel payment by idempotency key",id:"cancel-payment-by-idempotency-key",level:2}],m={toc:s};function c(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"create-and-manage-payments"},"Create And Manage Payments"),(0,r.kt)("p",null,"Payments API lets developers create and manage payments. It is important to remember, that payment cannot be completed without user interaction, meaning that the user has to ",(0,r.kt)("strong",{parentName:"p"},"swipe and approve payments")," inside MobilePay app."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"User confirmation",src:n(5397).Z,width:"960",height:"551"})),(0,r.kt)("h2",{id:"create-payment"},"Create payment"),(0,r.kt)("p",null,"The first step in your journey of collecting payments would be to initiate a new payment. You can do that using the following request."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Create payment"',title:'"Create','payment"':!0},'curl https://api.mobilepay.dk/v1/payments \\\n  -X POST \\\n  -H \'Authorization: Bearer {API_KEY}\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "amount": 1250,\n    "idempotencyKey": "{UUID}",\n    "paymentPointId": "{PAYMENT_POINT_ID}",\n    "redirectUri": "{URI_TO_YOUR_APP}"\n    "reference": "{YOUR_UNIQUE_KEY}",\n    "description": "Details on the product/service that the customer is buying"\n  }\'\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Response JSON example"',title:'"Response',JSON:!0,'example"':!0},'{\n  "paymentId": "186d2b31-ff25-4414-9fd1-bfe9807fa8b7",\n  "mobilePayAppRedirectUri": "mobilepay://merchant_payments?payment_id=186d2b31-ff25-4414-9fd1-bfe9807fa8b7"\n}\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"mobilePayAppRedirectUri")," should be used to redirect user to the MobilePay app.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Use ",(0,r.kt)("inlineCode",{parentName:"p"},"description")," to inform your customers to a greater extent. Description will be shown on the payment confirmation screen in MobilePay so the customer has more information about the product. The description will also be shown when the MobilePay user opens their payment receipt in the activity list.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"We suggest setting unique order or transaction id from your own system in the ",(0,r.kt)("inlineCode",{parentName:"p"},"reference")," field. The ",(0,r.kt)("inlineCode",{parentName:"p"},"reference")," field will be contained throughout the backend flow of the payment. Also in settlement reports in the MobilePay portal or from our Transaction Reporting API. End-users/customers will see the ",(0,r.kt)("inlineCode",{parentName:"p"},"reference")," field value in the receipt of the payment, found in the MobilePay app's activity tab.")),(0,r.kt)("h2",{id:"get-single-payment-details"},"Get single payment details"),(0,r.kt)("p",null,"Whenever there is a need you can retrieve details of a single payment and e.g. check the current state."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Retrieve payment"',title:'"Retrieve','payment"':!0},"curl https://api.mobilepay.dk/v1/payments/{PAYMENT_ID} \\\n  -X GET \\\n  -H 'Authorization: Bearer {API_KEY}'\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Response JSON example"',title:'"Response',JSON:!0,'example"':!0},'{\n  "paymentId": "186d2b31-ff25-4414-9fd1-bfe9807fa8b7",\n  "amount": 1250,\n  "description": "Lorem ipsum",\n  "paymentPointId": "7347ba06-95c5-4181-82e5-7c7a23609a0e",\n  "reference": "DFX101103518",\n  "redirectUri": "https://yourredirecturi",\n  "state": "initiated",\n  "initiatedOn": "2021-08-20T05:18:07Z",\n  "lastUpdatedOn": "2021-08-21T08:45:32Z",\n  "merchantId": "655ad36f-70b0-4add-a123-b943daca50e8",\n  "isoCurrencyCode": "DKK",\n  "paymentPointName": "Nullam tincidunt"\n}\n')),(0,r.kt)("p",null,"Property ",(0,r.kt)("inlineCode",{parentName:"p"},"state")," can have these values:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"initiated")," - initial state."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"reserved")," - MobilePay user approved payment, ready to be captured."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"captureStarted")," - special state where capture was started but is left in an unknown state. Capture has to be retried if this state is encountered."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"captured")," - final state, funds will be transferred during next settlement."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cancelledByMerchant")," - payment was cancelled by you."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cancelledBySystem")," - no user interactions with payment were made in 5-10 minutes after creation, so our automated job cancelled it."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"cancelledByUser")," - user cancelled payment inside MobilePay app.")),(0,r.kt)("h2",{id:"get-all-payments"},"Get all payments"),(0,r.kt)("p",null,"There's also a possibility to list all your payments in pages. Multiple searching criteria can be used as query parameters."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="List payments"',title:'"List','payments"':!0},"curl https://api.mobilepay.dk/v1/payments \\\n  -X GET \\\n  -H 'Authorization: Bearer {API_KEY}'\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Response JSON example"',title:'"Response',JSON:!0,'example"':!0},'{\n  "pageSize": 1,\n  "nextPageNumber": 2,\n  "payments": [\n    {\n      "paymentId": "186d2b31-ff25-4414-9fd1-bfe9807fa8b7",\n      "amount": 1250,\n      "description": "Lorem ipsum",\n      "paymentPointId": "7347ba06-95c5-4181-82e5-7c7a23609a0e",\n      "reference": "DFX101103518",\n      "redirectUri": "https://yourredirecturi",\n      "state": "initiated",\n      "initiatedOn": "2021-08-20T05:18:07Z",\n      "lastUpdatedOn": "2021-08-21T08:45:32Z",\n      "merchantId": "655ad36f-70b0-4add-a123-b943daca50e8",\n      "isoCurrencyCode": "DKK",\n      "paymentPointName": "Nullam tincidunt"\n    }\n  ]\n}\n')),(0,r.kt)("h2",{id:"capture-payment"},"Capture payment"),(0,r.kt)("p",null,"After you receive a notification that payment was reserved or you retrieve payment and it has a state ",(0,r.kt)("inlineCode",{parentName:"p"},"reserved"),", you must capture payment in order to end the flow and receive the money with a nightly transfer."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Partial capture availability is limited. Let us know your use case during onboarding, and we will let you know if it's available."),(0,r.kt)("li",{parentName:"ul"},"Reservations are canceled after 7 days."))),(0,r.kt)("p",null,"At this point you have 2 options:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You can capture the whole reserved amount."),(0,r.kt)("li",{parentName:"ul"},"You can do a partial capture and only capture the amount you need. Remaining amount will be returned to the user.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Capture payment"',title:'"Capture','payment"':!0},"curl https://api.mobilepay.dk/v1/payments/{PAYMENT_ID}/capture \\\n  -X POST \\\n  -H 'Authorization: Bearer {API_KEY}' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"amount\": 1250\n  }'\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"If you receive 5xx response while capturing the reservation then that most likely means the payment ended up in ",(0,r.kt)("strong",{parentName:"p"},"captureStarted")," state. You have to retry the capture in such case until you get either 2xx or 4xx. The capture call is idempotent.")),(0,r.kt)("h2",{id:"cancel-payment"},"Cancel payment"),(0,r.kt)("p",null,"If you changed your mind and want to cancel payment , you can do that using the following request."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Cancel payment"',title:'"Cancel','payment"':!0},"curl https://api.mobilepay.dk/v1/payments/{PAYMENT_ID}/cancel \\\n  -X POST \\\n  -H 'Authorization: Bearer {API_KEY}' \\\n")),(0,r.kt)("p",null,"Keep in mind, that payment can be cancelled in all states except ",(0,r.kt)("inlineCode",{parentName:"p"},"captured"),". If you've already captured payment, refunding is your only option.\nIf you cancel a reserved payment, reserved amount will be returned to the user."),(0,r.kt)("h2",{id:"cancel-payment-by-idempotency-key"},"Cancel payment by idempotency key"),(0,r.kt)("p",null,"You can also cancel a payment by sending us the same idempotency key that you've used in the create payment request.\nUse this endpoint when the outcome of the payment creation request is unknown (e.g. network/server error occurred and you didn't get a response). It allows cancelling only those payments that are in ",(0,r.kt)("inlineCode",{parentName:"p"},"initiated")," state. For all other scenarios, please use the ",(0,r.kt)("a",{parentName:"p",href:"#cancel-payment"},"endpoint above"),".\nAfter successful cancellation, you can create a new payment again."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Capture payment"',title:'"Capture','payment"':!0},"curl https://api.mobilepay.dk/v1/payments/cancel \\\n  -X POST \\\n  -H 'Authorization: Bearer {API_KEY}' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n    \"idempotencyKey\": {UUID}\n  }'\n")))}c.isMDXComponent=!0},5397:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/create-payment-app-dfe1507f073ed1813deb669f06f0912c.gif"}}]);