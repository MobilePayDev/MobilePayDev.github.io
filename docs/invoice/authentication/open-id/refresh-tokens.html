<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-invoice/authentication/open-id/refresh-tokens">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Refresh tokens | MobilePay Developer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://developer.mobilepay.dk/docs/invoice/authentication/open-id/refresh-tokens"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Refresh tokens | MobilePay Developer"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://developer.mobilepay.dk/docs/invoice/authentication/open-id/refresh-tokens"><link data-rh="true" rel="alternate" href="https://developer.mobilepay.dk/docs/invoice/authentication/open-id/refresh-tokens" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.mobilepay.dk/docs/invoice/authentication/open-id/refresh-tokens" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-206187508-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.0a50547b.css">
<link rel="preload" href="/assets/js/runtime~main.4ffa4d6d.js" as="script">
<link rel="preload" href="/assets/js/main.07e23728.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-blue.svg" alt="MobilePay" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-white.svg" alt="MobilePay" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Developer</b></a><a class="navbar__item navbar__link" href="/docs/app-payments">App Payments</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/invoice">Invoice</a><a class="navbar__item navbar__link" href="/docs/online">Online</a><a class="navbar__item navbar__link" href="/docs/pos">Point of Sale</a><a class="navbar__item navbar__link" href="/docs/subscriptions">Subscriptions</a><a class="navbar__item navbar__link" href="/docs/reporting">Reporting</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">API references</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/app-payments">App payments</a></li><li><a class="dropdown__link" href="/api/wehooks">Webhooks</a></li><li><a class="dropdown__link" href="/api/invoice">Invoice</a></li><li><a class="dropdown__link" href="/api/online">Online</a></li><li><a class="dropdown__link" href="/api/pos">PoS</a></li><li><a class="dropdown__link" href="/api/subscriptions">Subscriptions</a></li><li><a class="dropdown__link" href="/api/reporting">Reporting (v3)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/support">Support</a><a href="https://github.com/MobilePayDev/MobilePayDev.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/app-payments">App Payments</a><button aria-label="Toggle the collapsible sidebar category &#x27;App Payments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/invoice">Invoice</a><button aria-label="Toggle the collapsible sidebar category &#x27;Invoice&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/invoice/development-guide/getting-started">Development Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/invoice/authentication">Authentication</a><button aria-label="Toggle the collapsible sidebar category &#x27;Authentication&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/invoice/authentication/open-id">OAuth Access token</a><button aria-label="Toggle the collapsible sidebar category &#x27;OAuth Access token&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/authentication/open-id/authorize">Authorize</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/authentication/open-id/code">Get code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/authentication/open-id/tokens">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/invoice/authentication/open-id/refresh-tokens">Refresh tokens</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/invoice-issuers">Invoice Issuers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/api-endpoint-reference">API Endpoint Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/callbacks">Callbacks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/notifications">Notifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/visual-examples">Visual examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/release-note">Release Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/transition-to-one-platform">Transition to One Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/invoice/resources">Resources</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/online">Online</a><button aria-label="Toggle the collapsible sidebar category &#x27;Online&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/pos">Point of Sale</a><button aria-label="Toggle the collapsible sidebar category &#x27;Point of Sale&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/subscriptions">Subscriptions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Subscriptions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/reporting">Reporting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reporting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/support">Developer Support</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Support&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/invoice"><span itemprop="name">Invoice</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/invoice/authentication"><span itemprop="name">Authentication</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/invoice/authentication/open-id"><span itemprop="name">OAuth Access token</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Refresh tokens</span><meta itemprop="position" content="4"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Refresh tokens</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-refresh-token">Step 4: Refresh token<a href="#step-4-refresh-token" class="hash-link" aria-label="Direct link to Step 4: Refresh token" title="Direct link to Step 4: Refresh token">​</a></h2><p>To get a refresh token, you must include the offline_access scope when you initiate an authentication request through the authorize endpoint. To refresh your access token, using the Refresh Token you already got during authorization, make a POST request to the token endpoint. Read more <a href="https://auth0.com/docs/tokens/refresh-token/current#use-a-refresh-token" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="keep-the-session-alive-by-using-the-refresh-token">Keep the session alive by using the refresh token<a href="#keep-the-session-alive-by-using-the-refresh-token" class="hash-link" aria-label="Direct link to Keep the session alive by using the refresh token" title="Direct link to Keep the session alive by using the refresh token">​</a></h3><p>Whenever an <code>access_token</code> is required to access a protected resource, a client may use a <code>refresh_token</code> to get a new Access Token issued by the Authentication Server. Although <code>access_token</code> can be renewed at any time using <code>refresh_token</code>s, they should be renewed when old ones have expired, or when getting access to a new resource for the first time. When the <code>access_token</code> expires, the <code>refresh_token</code> can be used to obtain a fresh <code>access_token</code> with the same permissions, without further involvement from a user. When the <code>access_token</code> expires, you can use the <code>refresh_token</code> to get a new <code>access_token</code> by using the token endpoint as shown below:</p><p>Sample request:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST https://api.sandbox.mobilepay.dk/merchant-authentication-openidconnect/connect/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/x-www-form-urlencoded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: api.sandbox.mobilepay.dk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Body:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grant_type=refresh_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refresh_token=01cab0f861cdb89c326604cae408ae6e8c57e72c70c84143b93e04bbecb8c748</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_id=some.test.client.received.in.zipfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client_secret=mysecret.received.in.zip.file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Explanation of parameters:</p><table><thead><tr><th>Parameter</th><th>Description</th><th>Value</th><th>Required</th></tr></thead><tbody><tr><td><code>grant_type</code></td><td>A way to specify how the client will interact with the server</td><td>Must be set to &quot;refresh_token&quot;</td><td>Yes</td></tr><tr><td><code>refresh_token</code></td><td>The refresh token to be used</td><td>The existing refresh token</td><td>Yes</td></tr><tr><td><code>client_id</code></td><td>The client_id that you received by zip file</td><td>The client_id given in the zip file</td><td>Yes</td></tr><tr><td><code>client_secret</code></td><td>The client_secret that you received by zip file.</td><td>The client_secret given in the zip file.</td><td>Yes</td></tr></tbody></table><p><code>Refresh_tokens</code> are long-lived. This means when a client gets one from a server, this token must be stored securely to keep it from being used by potential attackers. Therefore, it is not safe to store them in the browser. If a <code>refresh_token</code> is leaked, it may be used to obtain new <code>access_tokens</code> (and access protected resources) until it is blacklisted or invalidated.
To get a <code>refresh_token</code>, you must include the <code>offline_access</code> scope when you initiate an authorization request through the authorize endpoint.</p><p>If the refresh token is valid, then you get back a new access token:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id-token&quot; : &quot;MIOf-U1zQbyfa3[...]MUfJHhvnUqIut9ClH0xjlDXGJAyqo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;access_token&quot;: &quot;eyJhbGciOiJ[...]K1Sun9bA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;token_type&quot;: &quot;Bearer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;expires_in&quot;: 300,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;token_type&quot;: &quot;Bearer&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;refresh_token&quot;: &quot;MIOf-U1zQbyfa3[...]MUfJHhvnUqIut9ClH0xjlDXGJAyqo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="invalid-tokens">Invalid tokens<a href="#invalid-tokens" class="hash-link" aria-label="Direct link to Invalid tokens" title="Direct link to Invalid tokens">​</a></h3><p>If you make an API call using an invalid token, you will receive a <code>401 Unauthorized</code> response back from the server. A token could be invalid and in need of regeneration if:</p><ul><li>It has expired.</li><li>The user has revoked the permission they initially granted </li><li>You have changed the (scope) your application is requesting.</li><li>A subsequent OpenID Connect flow that generated a new access token. The previous token will be invalidated if running Single Use tokens.
You should only ask for a new token if the access_token has expired or you want to refresh the claims contained in the ID Token. For example, it&#x27;s a bad practice to call the endpoint to get a new access_token every time you call an API, if you already have an active access_token. </li></ul><p>Refresh tokens can expire but are long-lived. They are subject to strict storage requirements to ensure they are not leaked.  Since a predictable expiry time is not the only contributing factor to token invalidation, it is very important that you code your applications to properly handle an encounter with a 401 error by redirecting the user back to the start of the authorization workflow.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pkce--code-challenge">PKCE / Code Challenge<a href="#pkce--code-challenge" class="hash-link" aria-label="Direct link to PKCE / Code Challenge" title="Direct link to PKCE / Code Challenge">​</a></h3><p>For more information on the PKCE protocol and the security considerations, see <a href="https://tools.ietf.org/html/rfc7636" target="_blank" rel="noopener noreferrer">IETF RFC 7636</a>. </p><p>MobilePay supports the <a href="https://tools.ietf.org/html/rfc7636" target="_blank" rel="noopener noreferrer">Proof Key for Code Exchange</a> protocol to make the authorization flow more secure. A unique code verifier is created for every authorization request, and its transformed value, called &quot;code_challenge&quot;, is sent to the authorization server to obtain the authorization code. Example: <a href="https://github.com/MobilePayDev/MobilePay-Invoice/blob/master/ClientExamples/ConsoleClientExample/Program.cs#L43%20" target="_blank" rel="noopener noreferrer">C# example</a>. Note that it is hidden in the framework. <a href="https://github.com/MobilePayDev/MobilePay-Invoice/blob/master/ClientExamples/ConsoleClientExample/Program.cs#L43%20" target="_blank" rel="noopener noreferrer">This line</a> calls a IdentityModel feature which automatically uses PKCE. </p><p>Terminology: </p><ul><li><strong>code verifier</strong>: A cryptographically random string that is used to correlate the authorization request to the token request. The client creates a one-time secret (code verifier)  that is used to generate a code challenge</li><li><strong>code challenge</strong>: A challenge derived from the code verifier that is sent in the authorization request, to be verified against later. Code challenge is also referred to as the code that you generated, and made cryptographically secure and sent to us in /authorize endpoint property code challenge. </li></ul><p><strong>PKCE Parameters</strong></p><ul><li><code>code_verifier</code>: A random value of 43-128 characters. Created by the client. Stored on the server upon an authorization request. The recommended value is a 32-octet sequence that is base64url-encoded to create a 43-octet URL safe string.</li><li><code>code_challenge_method</code>: The code challenge method used to generate the code challenge value. S256 – SHA256 encoding is performed: code_challenge=base64url(sha256(code_verifier))</li><li><code>code_challenge</code>: Value based on the code_verifier and the code_challenge_method.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private string CreateCodeChallenge()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _codeVerifier = RandomNumberGenerator.CreateUniqueId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var sha256 = HashAlgorithmProvider.OpenAlgorithm(HashAlgorithm.Sha256);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var challengeBuffer = sha256.HashData(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CryptographicBuffer.CreateFromByteArray(Encoding.UTF8.GetBytes(_codeVerifier)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte[] challengeBytes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CryptographicBuffer.CopyToByteArray(challengeBuffer, out challengeBytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Base64Url.Encode(challengeBytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is how IdentityServer do the validation: </p><ul><li>var codeVerifierBytes = Encoding.ASCII.GetBytes(codeVerifier);</li><li>var hashedBytes = codeVerifierBytes.Sha256();</li><li>var transformedCodeVerifier = Base64Url.Encode(hashedBytes);</li><li>return TimeConstantComparer.IsEqual(transformedCodeVerifier.Sha256(), codeChallenge);</li></ul><p>If you get an error that the code challenge is either too short or too long, please update the value of code_challenge to meet the requirements and try again. Regarding code_verifier, it has the same length requirements as code challenge.  </p><ul><li>CodeChallengeMinLength = 43</li><li>CodeChallengeMaxLength = 128</li></ul><p>The method for calculating code_challenge is <em>base64urlencoder(Sha256(code_verifier))</em> when challenge method is S256. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-access-be-revoked">How Can Access be Revoked?<a href="#how-can-access-be-revoked" class="hash-link" aria-label="Direct link to How Can Access be Revoked?" title="Direct link to How Can Access be Revoked?">​</a></h3><p>It might be useful for you to know, what happens in theory, if your merchant decides to revoke the consent. </p><ul><li>The merchant can revoke the consent for the Integrator. It&#x27;s done from the MobilePay Portal, specifically the menu item Settings → Integration. The Tab is empty if no consent is granted.  The merchant needs to have a SuperManager role in the MobilePay Portal in order to be allowed to remove the consent.</li><li>Subscriptions and Invoice merchants should have max one integrator. When the integrator has been granted consent, the integrator will be able to retrieve information about the Subscriptions Provider, and make API calls on behalf of the merchant. </li><li>Access can be revoked at any time by the merchant though, and once consent is revoked, the integrator won&#x27;t be able to access merchant data with their token, nor will they be able to refresh the token.  </li><li>If the merchant is changing from one integrator to another, the consent process should be coordinated between the merchant and the new integrator. The merchant will need to go through the authorize process again. </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practice">Best Practice<a href="#best-practice" class="hash-link" aria-label="Direct link to Best Practice" title="Direct link to Best Practice">​</a></h3><ul><li>Focus on having logic, that ensures that when you use <code>access token</code>, then you also check if it is expired. The logic should tell you, for how long the <code>access token</code> is valid, so that you can know, when it is time to refresh the <code>access token</code>,  without making a call to MobilePay service and receiving 401. <strong>When</strong> it is expired, then you can use <code>refresh_token</code> to get a new valid  <code>access token</code>.</li><li>The  <code>refresh_token</code>  are subject to strict storage requirements to ensure that they are not leaked.</li><li>Although  <code>access token</code> can be renewed at any time using <code>refresh_token</code>, they should only be renewed when old ones have expired, or when getting access to a new resource for the first time.</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>You should only ask for a new token if the <code>access_token</code> has expired or you want to refresh the claims contained in the ID Token. For example, it&#x27;s a bad practice to call the endpoint to get a new <code>access_token</code> every time you call an API.
Please avoid hitting the rate limits in that will throttle the amount of requests to this endpoint that can be executed using the same token from the same IP.</p></div></div><p>The long-lived <code>refresh_tokens</code> must never be exposed. If you have any suspicion that they might be, you should contact us at <a href="mailto:developer@mobilepay.dk" target="_blank" rel="noopener noreferrer">developer@mobilepay.dk</a> or the merchant in question, so the token can be revoked. </p><p><code>Refresh_tokens</code>  must be stored securely by an application since they allow a user to remain authenticated essentially forever.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/invoice/authentication/open-id/tokens"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tokens</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/invoice/invoice-issuers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Invoice Issuers</div></a></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 MobilePay. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4ffa4d6d.js"></script>
<script src="/assets/js/main.07e23728.js"></script>
</body>
</html>