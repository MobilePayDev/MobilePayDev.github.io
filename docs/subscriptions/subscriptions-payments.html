<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-subscriptions/subscriptions-payments" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Subscriptions Payments | MobilePay Developer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://developer.mobilepay.dk/docs/subscriptions/subscriptions-payments"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Subscriptions Payments | MobilePay Developer"><meta data-rh="true" name="description" content="When the Agreement between Merchant and MobilePay User is established, use the POST /api/providers//paymentrequests endpoint to en-queue Subscription Payments. This service accepts a JSON array of individual Subscription Payments to be processed asynchronously. You can batch payment requests into payloads of maximum of 2000 payments. We allow merchants to bundle multiple payment requests into a single HTTP request."><meta data-rh="true" property="og:description" content="When the Agreement between Merchant and MobilePay User is established, use the POST /api/providers//paymentrequests endpoint to en-queue Subscription Payments. This service accepts a JSON array of individual Subscription Payments to be processed asynchronously. You can batch payment requests into payloads of maximum of 2000 payments. We allow merchants to bundle multiple payment requests into a single HTTP request."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://developer.mobilepay.dk/docs/subscriptions/subscriptions-payments"><link data-rh="true" rel="alternate" href="https://developer.mobilepay.dk/docs/subscriptions/subscriptions-payments" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.mobilepay.dk/docs/subscriptions/subscriptions-payments" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-206187508-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.7873bfd6.css">
<link rel="preload" href="/assets/js/runtime~main.fcf19c63.js" as="script">
<link rel="preload" href="/assets/js/main.df3ca3c0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-blue.svg" alt="MobilePay" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-white.svg" alt="MobilePay" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Developer</b></a><a class="navbar__item navbar__link" href="/docs/app-payments">App Payments</a><a class="navbar__item navbar__link" href="/docs/invoice">Invoice</a><a class="navbar__item navbar__link" href="/docs/online">Online</a><a class="navbar__item navbar__link" href="/docs/pos">Point of Sale</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/subscriptions">Subscriptions</a><a class="navbar__item navbar__link" href="/docs/reporting">Reporting</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">API references</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/api/app-payments">App payments</a></li><li><a class="dropdown__link" href="/api/wehooks">Webhooks</a></li><li><a class="dropdown__link" href="/api/invoice">Invoice</a></li><li><a class="dropdown__link" href="/api/online">Online</a></li><li><a class="dropdown__link" href="/api/pos">PoS</a></li><li><a class="dropdown__link" href="/api/subscriptions">Subscriptions</a></li><li><a class="dropdown__link" href="/api/reporting">Reporting (v3)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/support">Support</a><a href="https://github.com/MobilePayDev/MobilePayDev.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/app-payments">App Payments</a><button aria-label="Toggle the collapsible sidebar category &#x27;App Payments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/invoice">Invoice</a><button aria-label="Toggle the collapsible sidebar category &#x27;Invoice&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/online">Online</a><button aria-label="Toggle the collapsible sidebar category &#x27;Online&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/pos">Point of Sale</a><button aria-label="Toggle the collapsible sidebar category &#x27;Point of Sale&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/subscriptions">Subscriptions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Subscriptions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/subscriptions/development-guide">Development Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;Development Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/subscriptions/authentication">Authentication</a><button aria-label="Toggle the collapsible sidebar category &#x27;Authentication&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/general-notes">General notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/subscriptions-providers">Subscriptions Providers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/agreement">Agreements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/subscriptions/subscriptions-payments">Subscriptions Payments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/one-off-payments">One-off Payments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/refund">Refund</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/invoice">Invoice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/release-notes">Release Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/glossary">Glossary of Terms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/api-principles">API principles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/transition-to-one-platform">💙🧡 Preparation for facade period</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/subscriptions/resources">Migration info 🔗</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/reporting">Reporting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reporting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/support">Developer Support</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Support&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/subscriptions"><span itemprop="name">Subscriptions</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Subscriptions Payments</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Subscriptions Payments</h1><p>When the <strong>Agreement</strong> between <strong>Merchant</strong> and MobilePay <strong>User</strong> is established, use the <code>POST /api/providers/{providerId}/paymentrequests</code> endpoint to en-queue <strong>Subscription Payments</strong>. This service accepts a JSON array of individual <strong>Subscription Payments</strong> to be processed asynchronously. You can batch payment requests into payloads of maximum of 2000 payments. We allow merchants to bundle multiple payment requests into a single HTTP request.
Notice that the <strong>Subscription Payments</strong> payload does not contain a currency code - this will be fetched from the <strong>Agreement</strong> using the provided <em>agreement_id</em>.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Create Payment Request</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;agreement_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fda31b3c-794e-4148-ac00-77b957a7d47f&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;amount&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.99&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;due_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2017-03-09&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;external_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PMT000023&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Monthly payment&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;grace_period_days&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-existing-payment-request">Update existing Payment Request<a href="#update-existing-payment-request" class="hash-link" aria-label="Direct link to Update existing Payment Request" title="Direct link to Update existing Payment Request">​</a></h2><p>Once created, Recurring Payment Request can be updated (until it expires or is executed), Use the <code>PATCH /api/providers/{providerId}/agreements/{agreementId}/paymentrequests/{paymentId}</code> endpoint to decrease the requested amount to be paid. It is possible to decrease the amount. However, it is not possible to increase it. We only validate based on the original amount set, we don&#x27;t track the history. If you have sent a payment request with a too-high amount by mistake, you then can delete that payment request, and send another payment request with the correct amount.  </p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.01&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/amount&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;op&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;replace&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-subscription-payments-work">How do Subscription Payments work<a href="#how-do-subscription-payments-work" class="hash-link" aria-label="Direct link to How do Subscription Payments work" title="Direct link to How do Subscription Payments work">​</a></h2><ul><li><em>Billing Cycle</em>: You can send your payments to us max <em>126 days</em> prior due date and min <em>1 day</em> prior due date. When creating new subscription payments, the Merchant is responsible for configuring the billing cycle so it matches their and customers needs. We support both fixed dates (for example, the 1st of the next month) and variable dates.</li><li>It is flexible to change when an existing subscription payment is billed next time. The customer just needs to have at least 1 day to evaluate the payment. The customer can evaluate the payment by opening the MobilePay app. In the activity list the customer is presented with the Pending payment.</li><li>For example: if you send the payment 1st of June before midnight, the earliest DueDate can be the 3rd of June.</li><li><em>Amount</em> :  The Merchant decides the amount on each Payment Request. For example: electricity will vary to a certain extent, depending on how much electricity the customer is using, which is why an electric bill will fluctuate each month. You simply specify the amount each time you send a Payment Request. This is useful in cases where you want to charge your customers a granular amount based on their consumption of your service during the billing cycle, instead of explicitly setting a fixed amount. For example, Window Wash Company can use metered billing to offer a service where they wash their customer’s windows as needed and charge at the end of the month for the total number of washes.</li><li>We recommend that you send the payments before 00:00:00 so that you are sure that they will be included in our payment processing.</li><li>The MobilePay user will be able to see Payments in the app from 8 days to 1 day before the due date depending on when you sent the payment.</li><li>If a payment changes status e.g. declined by users, a callback on the specific payment will be made to <code>/payment_status_callback_url</code></li><li>On the due date we process the payments starting from 02:00 local time. If some payments weren&#x27;t successfully completed, we will then try again at 06:00 local time and couple of more time per day. Read more about hiccups in <a href="https://github.com/MobilePayDev/MobilePayDev.github.io/edit/main/docs/subscriptions/subscriptions-payments.md#failed-payments" target="_blank" rel="noopener noreferrer">Failed payments</a>. Payment execution might take coupul of hours depending on payment load. We aim to complete all payment execution till 06:00 local time. Most heavy days is first and last days of the month, if possible we recommend you to choose other due date for your payment execution.</li><li>When <code>grace_period_days</code> field is not set or is set to <strong>1</strong>, we will keep retrying to complete the payment up until 23:59 of the same day. When <code>grace_period_days</code> is set to more than <strong>1</strong>, we will be trying to complete the payment for the specified number of days.</li><li>User will get a notification of approx. at 08:30 that we cannot process the payment and that they can complete it manually (by swiping). Notification will be sent every day at the same time for the whole grace period if <code>grace_period_days</code> is specified.</li><li>At 23:59 we will decline the transaction and revert back with a callback  </li><li>Subscription payments are collected automatically, so there is no need for the customer to swipe.</li><li>Reserve and Capture are managed by MobilePay.</li><li>note: The user cannot cancel their connection with the Merchant through MobilePay. They can solely disconnect their payment method. The merchant will receive callbacks in real-time, in case the customer unsubscribes to automatic payment in the MobilePay app. By default, the cancellation takes effect immediately. Afterward, you should clarify with the customer, how upcoming payments should be handled.</li></ul><p>Agreement disable_notification_management push notification. Merchants can set if their customers should be able to manage push notifications for an agreement or not. If the merchant chooses so, then the push notification is not displayed when signing a new agreement and when browsing agreement information.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-parameters">Request parameters<a href="#request-parameters" class="hash-link" aria-label="Direct link to Request parameters" title="Direct link to Request parameters">​</a></h3><table><thead><tr><th>Parameter</th><th>Type</th><th>Required</th><th>Description</th><th>Valid values</th></tr></thead><tbody><tr><td><strong>agreement_id</strong></td><td>guid</td><td>required</td><td><em>The Subscription <strong>Agreement</strong> identifier that maps a <strong>Merchant</strong> to a MobilePay <strong>User</strong>.</em></td><td></td></tr><tr><td><strong>amount</strong></td><td>number(0.00)</td><td>required</td><td><em>The requested amount to be paid.</em></td><td>Min 0.00, Max (FI) 2000.00 or Max (DK) 300000.00, decimals separated with a dot.</td></tr><tr><td><strong>due_date</strong></td><td>date</td><td>required</td><td><em>Payment due date. Must be at least 1 day in the future, otherwise the <strong>Subscription Payment</strong> will be declined.</em></td><td>ISO date format: yyyy-MM-dd</td></tr><tr><td><strong>external_id</strong></td><td>string(64)</td><td>required</td><td><em>The identifier of a specific payment in the external merchant&#x27;s system. Maximum length is 64 characters The external_id is visible on the <strong>Subscription Payment</strong> screen.</em></td><td></td></tr><tr><td><strong>description</strong></td><td>string(60)</td><td>required</td><td><em>Additional information of the <strong>Subscription Payment</strong> that is visible for the customer in the MobilePay app</em></td><td></td></tr><tr><td><strong>grace_period_days</strong></td><td>int</td><td>optional</td><td><em>Number of days to keep retrying the payment if it was not successful.</em></td><td>1, 2, 3</td></tr></tbody></table><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>External ID Recommendations</div><div class="admonitionContent_S0QG"><p>The recommendation for &quot;external_id&quot; is to use up to 30 symbols. &quot;external_id&quot; is provided by Merchant or Integrator when initiating payments and is used for correlating transactions between MobilePay and Merchant or Integrator system. We recommend that it is unique, as then it is easier for MobilePay to search in the logs. The payment &quot;external_id&quot; is usually the merchant&#x27;s internal &quot;order_id&quot;. A good starting point is to use UUID, in the format <code>123e4567-e89b-12d3-a456-426614174000</code>. UUIDs are not always the most human-friendly, so see the other tips too. For instant transfers &quot;external_id&quot; is used as the payment reference and will be truncated down to 30 symbols if it contains more. Truncated payment references will be visible in customers&#x27; bank statements.</p><p>If you need to make multiple payment requests in case the customer didn&#x27;t pay, you can add a suffix to the external_id to make it unique: If your internal external_id  is mp-shop-123-order123abc you can add -1 to get a unique MobilePay external_id mp-shop-123-order123abc-1 for the first attempt, mp-shop-123-order123abc-2 for the second, etc. This is useful if a customer doesn&#x27;t pay for their subscription, and when you are sending another request.</p></div></div><p>The <code>POST /api/providers/{providerId}/paymentrequests</code> service returns HTTP 202 - Accepted response if at least one payment is provided in the request payload.</p><p>The response body contains two lists:</p><p>-<strong>pending_payments</strong> - a map of the newly generated Subscription payment ID and the external ID, that was accepted for processing and now are in a <em>Pending</em> state.
-<strong>rejected_payments</strong> - a list of rejected payments. This can only occur if any of the mandatory fields are missing or do not conform to the format rule. Business logic validations are done asynchronously in the back-end (for example, rejecting if payments on the same due_date have the same external_id).</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">HTTP 202 Response body example</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;pending_payments&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;payment_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;263cfe92-9f8e-4829-8b96-14a5e53c9041&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;external_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PMT000023&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;rejected_payments&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;external_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;PMT000023&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;error_description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;The Amount field is required.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="frequency-of-payment-requests">Frequency of Payment Requests<a href="#frequency-of-payment-requests" class="hash-link" aria-label="Direct link to Frequency of Payment Requests" title="Direct link to Frequency of Payment Requests">​</a></h2><p> The merchant can send a payment max 126 days prior due date, and at least 1 day before the due date. Valid values are 1, 2, 4, 12, 26, 52, 365, 0. This means that the daily payment (365) is the most frequent. When you are requesting payment, you need to keep in mind that there cannot be more than one payment on the same due_date with the same external_id. The user can have a few pending payments on the same due date. E.g. User can have 3 pending payments on the same due_date but the external_id of those payments should be different.</p><ul><li><strong>External Id</strong> Payments cannot be created with the same external_id on same due_date.</li><li><strong>Multiple Recurring payments</strong>  Multiple recurring payment requests can be created within the period <!-- -->[126 before Due Date &gt;= Payment Request Date &gt;= 1 before Due Date]<!-- -->.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-of-frequency">Example of Frequency<a href="#example-of-frequency" class="hash-link" aria-label="Direct link to Example of Frequency" title="Direct link to Example of Frequency">​</a></h3><p>For example: if you have a customer where the frequency of an agreement is set to 4, that means  365 / 4 = 91.25 (approximately payment requests every 3rd month), if the agreement frequency is set to 52, then 365 / 52 (payment requests every week) and in case the frequency is set to 0 - payment can be requested in flexible recurrence.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="payment-screens">Payment screens<a href="#payment-screens" class="hash-link" aria-label="Direct link to Payment screens" title="Direct link to Payment screens">​</a></h2><p><a target="_blank" href="/assets/files/subs-Agreement_payments_3_new-b625854b406d2dfc2006f01971590776.png"><img loading="lazy" alt="Agreement payments" src="/assets/images/subs-Agreement_payments_3_new-b625854b406d2dfc2006f01971590776.png" width="5690" height="2235" class="img_ev3q"></a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="callbacks">Callbacks<a href="#callbacks" class="hash-link" aria-label="Direct link to Callbacks" title="Direct link to Callbacks">​</a></h2><p>Once the payment status changes from <em>Pending</em> to <em>Executed, Declined, Rejected</em> or <em>Failed</em>, a callback will be done to the callback address, which is configurable via <code>PATCH /api/providers/{providerId}</code> with path value <code>/payment_status_callback_url</code>. The <code>/payment_status_callback_url</code> should be a HTTPS. If you try to configure it to HTTP, you will get a bad request with the following error message: &quot;The hyperlink reference must use https scheme&quot;</p><p>We are sending callbacks in two ways:</p><ol><li>A batch that runs every 2 mins. It contains Subscription payments with status: Declined/Rejected/Failed/Executed/OneOff_Expired. So in theory, there is a possible delay of 2 mins.</li><li>Right after the user made an action. It contains OneOff_Reserved/OneOff_Rejected.</li></ol><p>Every two minutes we take up to 1000 events (notifications about payment state), group them by merchant, and make the calls. Therefore, as for merchant, you should get up to 1 call every two minutes.</p><p>We will post the integrator or merchant a callback, and expect a HTTP 2xx response. If not we will retry 8 times.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/payment_status_callback_url&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;op&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;replace&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>New Status</th><th>Condition</th><th>When to expect</th><th>Callback <em>status</em></th><th>Callback <em>status_text</em></th><th>Callback <em>status_code</em></th></tr></thead><tbody><tr><td>Executed</td><td><em>The payment was successfully executed on the due-date</em></td><td>After 03:15 in the morning of the due-date</td><td>Executed</td><td></td><td>0</td></tr><tr><td>Failed</td><td><em>Payment failed to execute during the due-date or at the end of the grace period.</em></td><td>After 23:59 of the due-date, or the last day of the grace period.</td><td>Failed</td><td>Payment failed to execute during the due date</td><td>50000</td></tr><tr><td>Rejected</td><td><em>User rejected the Pending payment in MobilePay</em></td><td>Any time during the 8-1 days period when the user is presented with the Pending payment in the MobilePay activity list.</td><td>Rejected</td><td>Rejected by user.</td><td>50001</td></tr><tr><td>Declined</td><td><em>Merchant declined the Pending payment via the API</em></td><td>Any time during the 8-1 days period when the user is presented with the Pending payment in the MobilePay activity list.</td><td>Declined</td><td>Declined by merchant.</td><td>50002</td></tr><tr><td>Declined</td><td><em><strong>Agreement</strong> is not in Active state.</em></td><td>Right after the payment request was received.</td><td>Declined</td><td>Declined by system: Agreement is not &quot;Active&quot; state.</td><td>50003</td></tr><tr><td>Declined</td><td><em>Another payment with the same ExternalId is already scheduled on that day for the user</em></td><td>Right after the payment request was received.</td><td>Declined</td><td>Declined by system: Found duplicates for the same DueDate and AgreementId or ExternalId.</td><td>50004</td></tr><tr><td>Declined</td><td>When the <strong>Agreement</strong> was canceled by the merchant or by system</td><td>Any time unless the retention period is set and active.</td><td>Declined</td><td>Declined by system: Agreement was canceled.</td><td>50005</td></tr><tr><td>Rejected</td><td>When the <strong>Agreement</strong> was canceled by the user</td><td>Any time unless the retention period is set and active.</td><td>Rejected</td><td>Declined by system: Agreement was canceled.</td><td>50005</td></tr><tr><td>Declined</td><td>A catch-all error code when payment was declined by the core system.</td><td>Right after the payment request was received.</td><td>Declined</td><td>Declined by system.</td><td>50006</td></tr><tr><td>Declined</td><td>Declined due to user status.</td><td>Right after the payment request was received.</td><td>Declined</td><td>Declined due to user status.</td><td>50009</td></tr><tr><td>Declined</td><td>When the <strong>Agreement</strong> does not exist</td><td>Right after the payment request was received.</td><td>Declined</td><td>Agreement does not exist.</td><td>50010</td></tr><tr><td>Declined</td><td>When the due date before the rule is violated</td><td>Right after the payment request was received.</td><td>Declined</td><td>Due date of the payment must be at least 1 day in the future.</td><td>50011</td></tr><tr><td>Declined</td><td>When the due date ahead rule is violated</td><td>Right after the payment request was received.</td><td>Declined</td><td>Due date must be no more than 126 days in the future.</td><td>50012</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="payment-states">Payment States<a href="#payment-states" class="hash-link" aria-label="Direct link to Payment States" title="Direct link to Payment States">​</a></h3><p><img loading="lazy" alt="Payment states" src="/assets/images/subs-PaymentStates-fcd35b46cff0810c36d83f3bc433b4ee.png" width="146" height="375" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="payment-validation">Payment Validation<a href="#payment-validation" class="hash-link" aria-label="Direct link to Payment Validation" title="Direct link to Payment Validation">​</a></h3><p>There are validation rules, that are applied asynchronously to each individual payment after you send an API request. Therefore, even though you get a response with pending payments, they may not be valid.  When you make a payment request, we will validate the request body itself, but we won&#x27;t apply business rules to individual payments. So it only validates if you have the required parameters with the correct types. So the response you get for the payment request does not say if the payment is pending, but if the payment creation is pending. Then the payments are processed in our system, and they will either be requested (valid) or declined (invalid).
You will receive a callback if certain business rules are not met and payment is declined. This will be sent to your payment status callback URL.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="failed-payments">Failed Payments<a href="#failed-payments" class="hash-link" aria-label="Direct link to Failed Payments" title="Direct link to Failed Payments">​</a></h3><p>The process for failed payments the DueDate is as follows:</p><ul><li>06:00 First hiccup is run at 06:00 on the due date. Once done, a notification about completion is returned. Merchant is informed about successful payments and user about failed payment.</li><li>13:30 Second hiccup is run at 13:30 on the due date. Once done, a notification about completion is returned. Merchant is informed about successful payments and user about failed payment.</li><li>18:00 20:00 22:30 23:40 - hiccups keep running throughout the day. Once done, a notification about completion is returned. Merchant is informed about successful payments and user about failed payment.</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The flow will be processed for the number of days that can be specified in <code>grace_period_days</code>, otherwise the flow will be processed once. Merchants will be notified about failed payments on the last day of the grace period.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="payment-state-diagram">Payment state diagram<a href="#payment-state-diagram" class="hash-link" aria-label="Direct link to Payment state diagram" title="Direct link to Payment state diagram">​</a></h3><p><img loading="lazy" alt="Payment states" src="/assets/images/subs-Recurring_payment_states2-c1d0d6960f151716b59125749331d071.png" width="2535" height="3142" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-callback-properties">Other callback properties<a href="#other-callback-properties" class="hash-link" aria-label="Direct link to Other callback properties" title="Direct link to Other callback properties">​</a></h3><table><thead><tr><th>Name</th><th>Type</th><th>Description</th><th>Format</th></tr></thead><tbody><tr><td><strong>agreement_id</strong></td><td>guid</td><td>Subscription agreement ID on the MobilePay side.</td><td></td></tr><tr><td><strong>payment_id</strong></td><td>guid</td><td>Subscription payment ID on the MobilePay side.</td><td></td></tr><tr><td><strong>amount</strong></td><td>number(0.00)</td><td>Amount withdrawn from the MobilePay user.</td><td></td></tr><tr><td><strong>currency</strong></td><td>string</td><td>Amount currency (agreement&#x27;s currency)</td><td></td></tr><tr><td><strong>payment_date</strong></td><td>date</td><td>Date of the batch when the payment was executed.</td><td>ISO 8601 UTC date: YYYY-MM-DD</td></tr><tr><td><strong>external_id</strong></td><td>string</td><td>Payment ID on the merchant&#x27;s side. Maximum length is 64 characters</td><td></td></tr><tr><td><strong>payment_type</strong></td><td>string</td><td>Indicates whether it is Regular subscription payment or one-off payment.</td><td><em>Regular</em> or <em>OneOff</em></td></tr></tbody></table><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Payment callback body example</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;agreement_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1b08e244-4aea-4988-99d6-1bd22c6a5b2c&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;payment_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;c710b883-6ed6-4506-9599-490ead89525a&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;amount&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.20&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;currency&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DKK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;payment_date&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2016-09-29&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Rejected&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;status_text&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Rejected by user.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;status_code&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;external_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SFPMT134560&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;payment_type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Regular&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-reconcile-subscriptions-payments">How to reconcile Subscriptions Payments<a href="#how-to-reconcile-subscriptions-payments" class="hash-link" aria-label="Direct link to How to reconcile Subscriptions Payments" title="Direct link to How to reconcile Subscriptions Payments">​</a></h2><p>You can choose a reference or ID on the subscription payments that your merchant sends via MobilePay Subscriptions. It is possible to do reconciliation in several ways.</p><ul><li>Callbacks: You get the status of the payment through the API callbacks. When the payment has the status <code>executed</code> then the customer has paid, and MobilePay sends a callback to you. Callbacks for subscription payments are found <a href="https://mobilepaydev.github.io/MobilePay-Subscriptions/payments#callbacks" target="_blank" rel="noopener noreferrer">here</a>. Callbacks for one-off payments are found <a href="https://mobilepaydev.github.io/MobilePay-Subscriptions/oneoffs#callbacks" target="_blank" rel="noopener noreferrer">here</a>.</li><li>Mapping <code>external_id</code> The individual transactions will contain the same <code>external_id</code>, that you have assigned, and that <code>external_id</code> will be returned through the API.  <code>external_id</code> is the identifier of a specific payment in the merchant and integrator system.</li><li>CSV file via MobilePay Portal: The Merchant logs in to our MobilePay portal on <a href="https://admin.mobilepay.dk/" target="_blank" rel="noopener noreferrer">MobilePay Portal</a>  where you can export the transactions in a CSV file. This method is quite manual, but it is an easy way for Merchants to see their payments.</li><li>Use the Transaction Reporting API which contains GET calls containing specific transaction and transfer information, specifically the parameter  <code>MerchantReference</code> as it directly is mapped to <code>external_id</code></li></ul><p>For example, if the merchant wants to use their FIK-Creditor-ID for transactions, then you simply choose the reference number, which can be the merchant FIK Creditor ID. There are no special requirements for the merchant FIK creditor-ID to be able to use it for MobilePay Subscriptions.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="user-notifications">User notifications<a href="#user-notifications" class="hash-link" aria-label="Direct link to User notifications" title="Direct link to User notifications">​</a></h2><p>As a MobilePay app user, the user can be informed about payment issues, depending on how the user has configured their Push Notification settings.  Push Notifications window: 08:30 - 22:00 DK time. We send push notifications to customers&#x27; smartphones. When a payment requires additional steps, such as customer authentication or exchange of card, the customer will be notified via push notifications. Upon receiving the push notification, the customer is prompted to complete the required action.</p><table><thead><tr><th>Description</th><th>When</th><th>Text</th><th>Buttons</th><th>Depends on these Notification settings</th><th>Type</th></tr></thead><tbody><tr><td><strong>Expired card:</strong> Card is expired or about to expire before the due date.</td><td><em>8 -1 days before the due date, 08:30</em></td><td><strong>English:</strong> Card is expired or about to expire. To continue with <em>Merchant</em> payment update your card information. <strong>Danish:</strong> For at betale til <em>Merchant</em> skal du opdatere dine kortinformationer. <strong>Finnish:</strong> Maksaaksesi *Merchant&#x27; - ole hyvä ja päivitä korttitietosi.</td><td><strong>Text</strong>: Opdater <strong>Navigation</strong>: Agreement Payments</td><td>OS, App</td><td>Subscription Payments</td></tr><tr><td><strong>General Reminder</strong></td><td><em>One day before the due date at 08:30</em></td><td><strong>English:</strong> Payment for merchant <em>Merchant</em> of <em>Amount</em> <em>Currency</em> will be executed tomorrow. <strong>Danish:</strong> I morgen betales <em>Amount</em> <em>Currency</em> til <em>Merchant</em>. <strong>Finnish:</strong> <em>Merchant</em>: <em>Amount</em> <em>Currency</em> maksu erääntyy huomenna.</td><td><strong>Text</strong>: Vis <strong>Navigation</strong>: Payment Overview</td><td>OS, App</td><td>Subscription Payments</td></tr><tr><td>Daily limit exceeded, increase to NemID</td><td>When the customer has exceeded daily limit</td><td><strong>English:</strong> You have exceeded the amount limit. <strong>Danish:</strong> Din daglige beløbsgrænse er nået - klik her for at forhøje den. <strong>Finnish:</strong> Maksuraja ylittynyt - Klikkaa tästä korottaaksesi maksurajaa.</td><td><strong>Text</strong>: Fortsæt <strong>Navigation</strong>: Agreement Payments</td><td>OS, App</td><td>Subscription Payments</td></tr><tr><td>Attached payment card is expired, the customer should change the card</td><td>When the card is expired</td><td><strong>English:</strong> We cannot complete your payment - your card has expired. <strong>Danish:</strong> Vi kan ikke gennemføre din betaling - dit betalingskort er udløbet. <strong>Finnish:</strong> Maksua ei voida suorittaa - Kortti on vanhentunut.</td><td><strong>Text</strong>: Skift dit betalingskort <strong>Navigation</strong>: Agreement Payments</td><td>OS, App</td><td>Subscription Payments</td></tr><tr><td>Payment in other hiccup state - user can approve manually.</td><td>When payment is in a hiccup state. Other issues with the Payment card, blocked, insufficient funds</td><td><strong>English:</strong> We can not complete your payment - click here to help us. <strong>Danish:</strong> Vi kan ikke gennemføre din betaling - klik her for at hjælpe os. <strong>Finnish:</strong> Maksua ei voida suorittaa - Klikkaa tästä auttaaksesi meitä.</td><td><strong>Text</strong>: Vis <strong>Navigation</strong>: Agreement payments</td><td>OS, App</td><td>Subscription Payments</td></tr><tr><td>Payment failed</td><td>When payment is in hiccup state</td><td><strong>English:</strong> Your payment for merchant <em>Merchant</em> failed to be completed. <strong>Danish:</strong> Vi kunne ikke gennemføre din betaling til <em>Merchant</em>. <strong>Finnish:</strong> Maksua <em>Merchant</em> ei voida toteuttaa.</td><td><strong>Text</strong>: Vis <strong>Navigation</strong>: Agreement payments</td><td>OS, App</td><td>Subscription Payments</td></tr></tbody></table><p><code>Suspended</code></p><p>It means that you can not withdraw the money from the customer&#x27;s payment card, and then the payment gets suspended. There can be various reasons why it can be suspended. If the problem persists, and there are not sufficient funds on the customer&#x27;s card, or/and if the card is expired or/and blocked, then the payment will fail. Suspended is a status internally for MobilePay to mark hiccupped payments, which is why it is not a part of the callback table above.</p><p><code>Suspended</code> will occur as soon as we have attempted 1 time - and that attempt has failed. It&#x27;s fine that the Merchant use &#x27;suspended&#x27; themselves to, in some way, nudge the customers to &#x27;do something.&#x27; But it is primarily MobilePay&#x27;s task - which we handle through push notifications and SMS.</p><p>Solution: MobilePay sends the customer a push notification, if there was an error with the card, in order to catch errors. If there were insufficient funds on the customer&#x27;s card, we also push the customer to execute the payment manually. The Merchant should contact the customer and have it cleared out with the customer.</p><p>We also send sms messages each day at 10:00 in Denmark and 11:00 in Finland for customers who have suspended payments (one sms for each payment).</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/subscriptions/agreement"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Agreements</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/subscriptions/one-off-payments"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">One-off Payments</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#update-existing-payment-request" class="table-of-contents__link toc-highlight">Update existing Payment Request</a></li><li><a href="#how-do-subscription-payments-work" class="table-of-contents__link toc-highlight">How do Subscription Payments work</a><ul><li><a href="#request-parameters" class="table-of-contents__link toc-highlight">Request parameters</a></li></ul></li><li><a href="#frequency-of-payment-requests" class="table-of-contents__link toc-highlight">Frequency of Payment Requests</a><ul><li><a href="#example-of-frequency" class="table-of-contents__link toc-highlight">Example of Frequency</a></li></ul></li><li><a href="#payment-screens" class="table-of-contents__link toc-highlight">Payment screens</a></li><li><a href="#callbacks" class="table-of-contents__link toc-highlight">Callbacks</a><ul><li><a href="#payment-states" class="table-of-contents__link toc-highlight">Payment States</a></li><li><a href="#payment-validation" class="table-of-contents__link toc-highlight">Payment Validation</a></li><li><a href="#failed-payments" class="table-of-contents__link toc-highlight">Failed Payments</a></li><li><a href="#payment-state-diagram" class="table-of-contents__link toc-highlight">Payment state diagram</a></li><li><a href="#other-callback-properties" class="table-of-contents__link toc-highlight">Other callback properties</a></li></ul></li><li><a href="#how-to-reconcile-subscriptions-payments" class="table-of-contents__link toc-highlight">How to reconcile Subscriptions Payments</a></li><li><a href="#user-notifications" class="table-of-contents__link toc-highlight">User notifications</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 MobilePay. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fcf19c63.js"></script>
<script src="/assets/js/main.df3ca3c0.js"></script>
</body>
</html>